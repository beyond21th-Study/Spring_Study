# 6.4 스프링의 프록시 팩토리 빈
## 6.4.1 Proxy Factory Bean

- 스프링의 ProxyFacotryBean은 프록시를 생성세서 빈 오브젝트로 등록하게 해주는 팩토리 빈.
- 기존의 ㅆ톄개툚ㅊ새교ㅠㄷ무rhk ekffl, ProxyFactoryBean은 순수하게 프록시를 생성하는 작업만을 담다하고 프록시를 통해 제공해줄 부가기능은 별도의 빈에 둘 수 있다.

- ProxyFactoryBean이 생성하는 프록시에서 사용할 부가기능은 MethodInterceptor 인터페이스를 구현해서 만든다.
- InvocationHandler의 invoke()메소드는 타깃 오브젝트에 대한 정보를 제공하지 않기 때문에 타깃은 InvocationHandler를 구현한 클래스가 직접 알고 있어야 한다.
- 하지만 MethodInterceptor는 MethodInterceptor의 invoke() 메소드는 ProxyFactoryBean으로부터 타깃 오브젝트에 대한 정보까지도 함께 제공받는다.
 <br> 이 덕분에 MethodInterceptor는 타깃 오브젝트에 상관없이 독립적으로 만들어질 수 있다.
  <br> 그리고 MethodInterceptor 오브젝트는 타깃이 다른 여러 프록시에서 함께 사용할 수 있고 싱글톤 빈으로 등록 가능하다.

## 어드바이스 : 타깃이 필요 없는 순수한 부가기능

- MethodInterceptor를 구현한 UppercaseAdvice에는 타깃 오브젝트가 등장하지 않는다.
  <br> MethodInterceptor로는 메소드 정보와 함께 타깃 오브젝트가 담긴 MethodInvocation 오브젝트가 전달된다.
  <br> MethodInvocation은 타깃 오브젝트의 메소드를 실행할 수 있는 기능이 있기 때문에 MethodInterceptor는 부가기능을 제공하는 데만 집중할 수 있다.
  <br> MethodInvocation은 일종의 콜백 오브젝트로, proceed()메소드를 실행하면 타깃 오브젝트의 메소드를 내부적으로 실행해주는 기능이 있다.
<br> MethodInvocation 구현 클래스는 일종의 공유 가능한 템플릿처럼 동작하는 것이다.

- ProxyFactoryBean은 작은 단위의 템플릿/콜백 구조를 응용해서 적용했기 때문에 템플릿 역할을 하는 MethodInvocation을 싱글톤으로 두고 공유할 수 있다.
- SQL 파라미터 정보에 종속되지 않는 JdbcTemplate이기 때문에 수많은 DAO 메소드가 하나의 JdbxTemplate 오브젝트를 공유할 수 있는 것과 마찬가지다.

- ProxyFactoryBean에 이 MethodInterceptor를 설정해줄 때에는 일반적인 DI 경우처럼 수정자 메소드를 사용하는 대신 addAdvice()라는 메소드를 사용한다.
  <br> add라는 이름에서 알 수 있듯이 ProxyFactoryBean 하나만으로 여러 개의 부가기능을 제공해주는 프록시를 만들 수 있다는 뜻이다.
  <br> 새로운 부가기능을 추가할 때마다 프록시와 프록시 팩토리 빈도 추가해줘야 한다는 프록시 팩토리 빈의 문제를 해결 할 수 있다.
  <br> 많은 부가기능을 적용 하더라도 ProxyFactoryBean 하나면 충분하다.

- MethodInterceptor 오브젝트를 추가하는 메소드 이름은 addMethodInterceptor가 아니고 addAdvice이다.
- MethodInterceptor는 Advice 인터페이스를 상속하고 있는 서브인터페이스이기 때문이다.
- 어드바이스란 MethodInterceptor처럼 타깃 오브젝트에 적용하는 부가기능을 담은 오브젝트이다.

- 스프링의 ProxyFactoryBean은 어떻게 인터페이스 타입을 제공받지도 않고 Hello 인터페이스를 구현한 프록시를 만들어낼 수 있을까?
  <br> -> ProxyFactoryBean도 setInterfaces() 메소드를 통해서 구현해야 할 인터페이스를 지정할 수 있지만 인터페이스를 굳이 알려주지 않아도
  <br> ProxyFactoryBean에 있는 인터페이스 자동검출 기능을 사용해 타깃 오브젝트가 구현하고 있는 인터페이스 정보를 알아낸다.
  <br> 그리고 알아낸 인터페이스를 모두 구현하는 프록시를 만들어준다. 타깃 오브젝트가 구현하고 있는 모든 인터페이스를 동일하게 구현하는 프록시를 만들어주는 기능이다.
  <br> 타깃 오브젝트가 구현하는 인터페이스 중에서 일부만 프록시에 적용하기를 원한다면 인터페이스에 정보를 직접 제공해줘도 된다.

  






